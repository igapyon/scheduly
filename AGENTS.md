# AGENTS.md — Codex 作業ガイド

このリポジトリにおける支援AI（OpenAI Codex CLI 互換）の行動方針・許可範囲・作業手順を定義します。ここに記載のルールは、リポジトリ直下配下のすべてのディレクトリに適用されます。

## 行動ポリシー（必須遵守）
- 外部書き込みの禁止
  - リモートへの `git push`、GitHub 上での PR 作成・マージ・レビュー・ラベル操作など「外部サービスへの書き込み操作」は行わない。
  - GitHub CLI (`gh`) 等を用いたPR生成・操作も行わない。
- 許可される操作（ローカル限定）
  - ブランチ作成、ローカルコミット、差分抽出、タグ・ブランチの比較調査。
  - ドキュメント更新（`docs/external/CHANGELOG.md`、`docs/internal/DEVELOPER_NOTES.md` など）。
  - PR 用文面ドラフトの作成（`pr/*.md`）。
- 承認/権限
  - ネットワークアクセスやグローバル設定変更が必要な操作は実施しない。必要な場合は手順を提示する。
  - 破壊的操作（履歴改変、大規模削除）は明示的な依頼がない限り行わない。

補足: この方針は `docs/internal/DEVELOPER_NOTES.md` の「Codex（支援AI）の権限と作業範囲」にも重ねて記載しています。

## 典型ワークフロー

### タグ以降の変更を基に PR ドラフトを用意する
1) 変更調査
   - `git log <tag>..HEAD --oneline --decorate --graph` で差分コミットを列挙。
   - `git show --name-status <commit>` でファイル影響を確認。
2) 作業ブランチ（ローカル）
   - 例: `release/after-<tag>` を `<tag>` から作成し、必要なコミットのみ cherry-pick。
3) ドラフト作成
   - `pr/release-after-<tag>.md` に要約（概要、コミット一覧、変更ファイル、diffstat、注意点）を作成。
   - `docs/external/CHANGELOG.md` に同内容のエントリを追記。
4) ハンドオフ
   - 人間が `git push -u origin release/after-<tag>` → GitHub 上で PR 作成。

### 変更ドキュメントの更新
- 変更概要は `docs/external/CHANGELOG.md` に日付単位で追記。
- 開発ルールや運用フローは `docs/internal/DEVELOPER_NOTES.md` に追記。

## 命名・運用の指針
- ブランチ: `release/after-<tagYYYYMMDD>`、`fix/<topic>`、`feat/<topic>` 等。
- PR ドラフト: `pr/<topic>.md`（タイトル、概要、変更点、影響範囲、テスト観点、注意事項）。
- コミット: 和文主体で可。短い要約 + 必要なら本文に背景と影響範囲。

## 実装・修正方針
- 既存スタイルに合わせ最小限・局所的に修正する。
- 根本原因を直すことを優先し、無関係な修正は行わない。
- 必要に応じて関連ドキュメントを更新。不要なボイラープレートは避ける。

## 品質チェック
- 可能なら関連のローカルテスト・lint を実行（ネットワーク依存のある処理は除く）。
- 大量変更時は差分の要約（diffstat）と影響ファイル一覧を PR ドラフトに含める。

## コミュニケーション
- 実行前に簡潔な予告（やること/狙い）→ 実施 → 要約報告（結果/次の一手）。
- 長時間処理や大きな変更の前に意図を共有し、合意形成を優先。

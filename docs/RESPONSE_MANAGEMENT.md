# Response Management Plan

参加者の回答（○ / △ / × やコメント）を管理者が把握し、最終的な日程確定に活かすための管理画面を追加する計画をまとめます。現状は `admin.jsx` が候補（ICS）管理を担っているため、回答管理は別画面として切り出す方針です。

## 目的

- 参加者ごとの回答状況を一覧・検索・フィルタリングできるようにする。
- 特定候補の回答内訳を素早く確認し、確定候補の決定を支援する。
- 必要に応じて管理者が回答を修正したり、コメントを追記したりできるようにする。
- 将来のサーバー/API 実装時にも活用できるデータモデルを想定する。

## 画面方針

- 仮称: `admin-responses.jsx` + `public/user.html`
- ナビゲーション: `admin.jsx` のヘッダーやメニューから「参加者回答管理」を開けるようにする。
- レイアウト案
  1. **上部**  
     - 対象プロジェクトの概要（タイトル／概要／回答締切など）
     - フィルター（候補別、参加者別、ステータス別など）
  2. **メイン**  
     - 参加者 × 候補のマトリクス表示（○ / △ / × / コメント）
     - 参加者ごとの詳細カード（過去の変更履歴やメモ）
  3. **サイド**  
     - 候補ごとの集計（参加者数、コメント、確定候補の候補など）
     - 確定候補を選択するアクション（後で ICS エクスポートに反映）

### UI ワイヤーフレーム（テキストスケッチ）

```
┌────────────────────────────────────────────┐
│ Header / Breadcrumbs                       │
│  • プロジェクト名  /  調整フェーズ           │
│  • 「プロジェクト管理へ戻る」ボタン           │
└────────────────────────────────────────────┘
┌────────────────────────────────────────────┐
│ Top Controls                                │
│  [参加者フィルター▼] [Mark:○/△/×] [検索🔍]                  │
│  回答締切: 2025-05-01 23:59 / 参加者 12 人             │
└────────────────────────────────────────────┘
┌────────────────────────────────────────────┐
│ Tabs (React mock)                          │
│  ┌──────────────┬──────────────┐            │
│  │ 日程ごと      │ 参加者ごと      │            │
│  └──────────────┴──────────────┘            │
└────────────────────────────────────────────┘
┌────────────────────────────────────────────┬───────────────┐
│ Responses Matrix                            │ Side Panel    │
│ ┌─────────────┬───────────┬───────────┬───────────┐ │               │
│ │ Participant  │ 4/26 Day1 │ 4/27 Day2 │ 4/28 Day3 │ │               │
│ ├─────────────┼───────────┼───────────┼───────────┤ │ ┌───────────┐ │
│ │ 佐藤         │ ○ (メモ)    │ △         │ ×         │ │ │ Slot Stats│ │
│ │ 鈴木         │ ○          │ △ (⚠︎)    │ ○         │ │ │ ○: 8      │ │
│ │ ...         │ ...        │ ...       │ ...       │ │ │ △: 3      │ │
│ └─────────────┴───────────┴───────────┴───────────┘ │ │ ×: 1      │ │
│ クリックで右側に詳細カードを表示                          │ │ 確定候補✅ │ │
│                                                       │ └───────────┘ │
│                                                       │ ┌───────────┐ │
│                                                       │ │ Participant│ │
│                                                       │ │ Details   │ │
│                                                       │ │ ・連絡先    │ │
│                                                       │ │ ・コメント履歴 │ │
│                                                       │ │ ・回答修正UI │ │
│                                                       │ └───────────┘ │
└────────────────────────────────────────────┴───────────────┘
┌────────────────────────────────────────────┐
│ Footer Actions                              │
│  [CSV エクスポート] [レスポンス更新履歴を見る] [確定候補を送信] │
└────────────────────────────────────────────┘
```

上記はモバイル表示では縦積みになる前提。スマートフォンでは集計カードを下部に回し、マトリクスは横スクロール対応のテーブルまたはカード型リストを検討する。

## データモデルのメモ

現段階ではフロント内でモックとして保持。将来的にはサーバーで永続化予定。

```ts
type Participant = {
  id: string;
  name: string;
  contact?: string;
};

type Response = {
  id: string;
  projectId: string;
  participantId: string;
  slotId: string;
  mark: "o" | "d" | "x" | null;
  comment?: string;
  updatedAt: string;
};

type Slot = {
  id: string;
  projectId: string;
  ical: {
    uid: string;
    dtstart: string;
    dtend: string;
    tzid: string;
    status: string;
    sequence: number;
    dtstamp: string;
  };
};
```

## 今後の実装ステップ

1. **UI モック作成**  
   - 既存の参加者モック (`user.jsx`) のデータを流用し、React state で回答一覧を生成。
   - `admin-responses.jsx` を作成し、テーブルや集計カードを表示できるようにする。

2. **管理アクション追加**  
   - 管理者が回答を手動修正できる UI を提供。
   - 候補にメモを残したり、確定候補をマークする機能を検討。

3. **ICS との統合**  
   - 確定候補が決まったら `admin.jsx` 側に通知し、エクスポート候補に反映。
   - 将来的には API を介して参加者へ通知する導線を整備。

4. **サーバー/API 実装（将来）**  
   - Project / Slot / Participant / Response の CRUD を提供する REST API を設計。
   - 認証（URL トークン、パスワード、認可など）を検討。

## 補足

- 参加者が自分の回答を後から修正できる前提の場合、管理者 UI でも履歴管理が求められる可能性がある。
- 大規模なプロジェクトでは検索・フィルタリング機能のパフォーマンスが課題になるため、UI 設計時からページネーション／仮想スクロールを意識する。

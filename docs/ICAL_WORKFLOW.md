# iCal (ICS) Workflow

Scheduly で扱う日程候補は、ICS (iCalendar) をベースに整備・配布することを前提にしています。ICS の準備方法には大きく以下の 2 系統があり、いずれも最終的には `UID`, `DTSTAMP`, `TZID` などのメタデータを揃えて管理者 UI に取り込みます。

## 1. 外部カレンダーで作成 → Scheduly にインポート

1. Google Calendar 等で予定を作成し、対象イベント（またはカレンダー）を ICS としてエクスポートする。
2. 管理 UI (`public/index.html`) の「ICS から追加」からファイルを選択し、プレビューを確認。
3. `UID` が既存候補と一致するものは `DTSTAMP` を比較し、新しいものだけを更新。それ以外は新規候補として取り込む。
4. 取り込んだ候補は Scheduly 内で編集・配布できる。

### このルートの特徴
- 外部サービスで詳細調整を行い、その結果を Scheduly へ連携させたいケースに向く。
- UID および DTSTAMP を正しく持っている ICS であることが前提。外部サービスとの二重管理になるため、同期タイミングを明確にしておく必要がある。

## 2. Scheduly 内で直接入力 → 必要に応じて iCal をエクスポート

1. 管理 UI 上で候補日時・場所・説明などを直接入力する。
2. `exportCandidateToICal`, `exportAllCandidatesToICal` を使って個別またはまとめて ICS を生成できる。
3. 将来的には `VEVENT` に `VTIMEZONE` を添付したり、複数候補をまとめて配布する動線を整える。

### このルートの特徴
- Scheduly を ICS のソース（真のデータ）として扱えるため、参加者回答や確定日時の管理と一体化しやすい。
- 外部連携が不要であれば、このルートだけで完結させることも可能。

## ICS を扱う際のメタデータ方針

| 項目 | 役割 | 備考 |
|------|------|------|
| UID | 候補のユニーク識別子 | 外部との同期時に必須。同じ UID を持つイベントは同じ候補として扱う。 |
| DTSTAMP | 更新時刻 | 同じ UID の候補が複数存在する場合、新しい方を採用する判断材料。 |
| SEQUENCE | 版数 | 既存の ICS をベースにインクリメントする運用。 |
| DTSTART / DTEND | 開始・終了日時 | タイムゾーンも合わせて考慮する。 |
| TZID | タイムゾーン ID | 現状は候補ごとに設定。将来的には `VTIMEZONE` の添付を検討。 |
| LOCATION / DESCRIPTION / STATUS | 補足情報 | 参加者への案内にも利用。 |

## 今後の検討事項

- `VTIMEZONE` の自動付与（特に海外メンバーがいる場合）
- ICS の差分通知（外部の更新を定期的に取り込みたい場合）
